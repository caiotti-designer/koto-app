<!DOCTYPE html>
<html>
<head>
    <title>Storage Migration</title>
</head>
<body>
    <h1>Storage Migration Tool</h1>
    <button onclick="migrateStorage()">Migrate Storage Keys</button>
    <div id="output"></div>

    <script>
        function migrateStorage() {
            const output = document.getElementById('output');
            output.innerHTML = '';
            
            try {
                // Check for data in wrong key
                const wrongData = localStorage.getItem('koto_prompt_categories');
                
                if (wrongData) {
                    output.innerHTML += '<p>Found data in koto_prompt_categories</p>';
                    
                    // Get existing data from correct key
                    const existing = localStorage.getItem('koto_categories') || '[]';
                    const existingData = JSON.parse(existing);
                    const wrongDataParsed = JSON.parse(wrongData);
                    
                    // Merge data, avoiding duplicates
                    const merged = [...existingData];
                    wrongDataParsed.forEach(item => {
                        if (!existingData.find(ex => ex.id === item.id)) {
                            merged.push(item);
                        }
                    });
                    
                    // Save merged data to correct key
                    localStorage.setItem('koto_categories', JSON.stringify(merged));
                    
                    // Remove wrong key
                    localStorage.removeItem('koto_prompt_categories');
                    
                    output.innerHTML += '<p>Successfully migrated data to koto_categories</p>';
                    output.innerHTML += '<p>Migrated ' + wrongDataParsed.length + ' items</p>';
                } else {
                    output.innerHTML += '<p>No data found in koto_prompt_categories - no migration needed</p>';
                }
                
                // Show current data
                const currentData = localStorage.getItem('koto_categories');
                if (currentData) {
                    const parsed = JSON.parse(currentData);
                    output.innerHTML += '<p>Current koto_categories has ' + parsed.length + ' items</p>';
                }
                
            } catch (error) {
                output.innerHTML += '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>